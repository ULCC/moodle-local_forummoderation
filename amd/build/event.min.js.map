{"version":3,"file":"event.min.js","sources":["../src/event.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module used when managing enterprise customfields.\n *\n * @module      local_forummoderation\n * @copyright   2024 Yahya (yahya@teruselearning.co.uk)\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * */\n\n\nimport $ from \"jquery\";\nimport Selectors from \"./selectors\";\nimport Services from \"./services\";\nimport CustomFormData from \"./customformdata\";\nimport Helpers from \"./helpers\";\nclass Event {\n    constructor() {\n        this.reportPostSelector = Selectors.actions.reportPost;\n        this.eventListeners = {};\n    }\n\n    init() {\n        new Helpers().createLinkReportModerator();\n    }\n\n    addEvent(eventType, handler) {\n        if (!this.eventListeners[eventType]) {\n            this.eventListeners[eventType] = [];\n            document.addEventListener(eventType, (evt) => {\n                this.eventListeners[eventType].forEach((listener) => {\n                    if (evt.target.closest(listener.selector)) {\n                        listener.handler(evt);\n                    }\n                });\n            });\n        }\n        this.eventListeners[eventType].push({ selector: this.reportPostSelector, handler: handler });\n    }\n\n    reportPostForum(evt) {\n        evt.preventDefault();\n        const spinner = new Helpers().createSpinner(\"spinner\");\n        const parentElement = evt.target;\n        parentElement.insertAdjacentElement('afterend', spinner);\n        $(evt.target).hide();\n        $(spinner).show();\n\n        const postId = parentElement.getAttribute(\"data-post-id\");\n        const message = \"\";\n        const formData = this.prepareFormDataReport(postId, message);\n        new Services($.ajax).reportPost(formData, res => {\n            const { success } = JSON.parse(res);\n            if (success) {\n                window.location.reload();\n            }\n        });\n    }\n\n    prepareFormDataReport(postId, message) {\n        return new CustomFormData({\n            \"postId\": parseInt(postId),\n            \"courseId\": M.cfg.courseId,\n            \"contextId\": M.cfg.contextid,\n            \"courseContextId\": M.cfg.courseContextId,\n            \"contextInstanceId\": M.cfg.contextInstanceId,\n            \"action\": \"report-post\",\n            \"message\": message,\n            \"sesskey\": M.cfg.sesskey\n        }).toFormData();\n    }\n}\n\nexport default Event;"],"names":["constructor","reportPostSelector","Selectors","actions","reportPost","eventListeners","init","Helpers","createLinkReportModerator","addEvent","eventType","handler","this","document","addEventListener","evt","forEach","listener","target","closest","selector","push","reportPostForum","preventDefault","spinner","createSpinner","parentElement","insertAdjacentElement","hide","show","postId","getAttribute","formData","prepareFormDataReport","Services","$","ajax","res","success","JSON","parse","window","location","reload","message","CustomFormData","parseInt","M","cfg","courseId","contextid","courseContextId","contextInstanceId","sesskey","toFormData"],"mappings":";;;;;;;8UA8BIA,mBACSC,mBAAqBC,mBAAUC,QAAQC,gBACvCC,eAAiB,GAG1BC,YACQC,kBAAUC,4BAGlBC,SAASC,UAAWC,SACXC,KAAKP,eAAeK,kBAChBL,eAAeK,WAAa,GACjCG,SAASC,iBAAiBJ,WAAYK,WAC7BV,eAAeK,WAAWM,SAASC,WAChCF,IAAIG,OAAOC,QAAQF,SAASG,WAC5BH,SAASN,QAAQI,iBAK5BV,eAAeK,WAAWW,KAAK,CAAED,SAAUR,KAAKX,mBAAoBU,QAASA,UAGtFW,gBAAgBP,KACZA,IAAIQ,uBACEC,SAAU,IAAIjB,kBAAUkB,cAAc,WACtCC,cAAgBX,IAAIG,OAC1BQ,cAAcC,sBAAsB,WAAYH,6BAC9CT,IAAIG,QAAQU,2BACZJ,SAASK,aAELC,OAASJ,cAAcK,aAAa,gBAEpCC,SAAWpB,KAAKqB,sBAAsBH,OAD5B,QAEZI,kBAASC,gBAAEC,MAAMhC,WAAW4B,UAAUK,YAChCC,QAAEA,SAAYC,KAAKC,MAAMH,KAC3BC,SACAG,OAAOC,SAASC,YAK5BV,sBAAsBH,OAAQc,gBACnB,IAAIC,wBAAe,QACZC,SAAShB,iBACPiB,EAAEC,IAAIC,mBACLF,EAAEC,IAAIE,0BACAH,EAAEC,IAAIG,kCACJJ,EAAEC,IAAII,yBACjB,sBACCR,gBACAG,EAAEC,IAAIK,UAClBC"}