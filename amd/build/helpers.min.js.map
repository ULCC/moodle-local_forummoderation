{"version":3,"file":"helpers.min.js","sources":["../src/helpers.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport GetString from \"./strings\";\nimport Services from \"./services\";\nimport $ from \"jquery\";\nimport ModalFactory from 'core/modal_factory';\n\n/**\n * AMD module used when managing enterprise customfields.\n *\n * @module      local_forummoderation\n * @copyright   2024 Yahya (yahya@teruselearning.co.uk)\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * */\n\nclass Helpers {\n    createSpinner(classname) {\n        const spinner = document.createElement(\"div\");\n        spinner.className = classname;\n        return spinner;\n    }\n\n    async checkForumPostUser(postId) {\n        return new Promise(resolve => {\n            new Services($.ajax).checkForumPostUser(postId, res => {\n                resolve(JSON.parse(res).data);\n            });\n        });\n    }\n\n    async modalNotification() {\n        const strings = new GetString();\n        const title = await strings.get(\"message:alertreported_title\");\n        const message = await strings.get(\"message:alertreported_desc\");\n        const alert = new Helpers().createAlert(\"\", title, message);\n        const titlemodal = await strings.get(\"message:modal_title\");\n\n        const modal = await ModalFactory.create({\n            title: titlemodal,\n            body: alert,\n            footer: 'Footer',\n        }, $('a.item-delete'));\n        return modal;\n    }\n    async createLinkReportModerator(user) {\n        let postActionDivs = document.querySelectorAll('div.post-actions');\n        // let discussname = document.querySelector(\"h3.discussionname\");\n        // const strings = new GetString();\n        // const title = await strings.get(\"message:alertreported_title\");\n        // const message = await strings.get(\"message:alertreported_desc\");\n        // const alert = new Helpers().createAlert(\"alert-info\", title, message);\n        // add element after discussname\n        if (localStorage.getItem(\"success\") !== null) {\n            const modal = await this.modalNotification();\n            modal.show();\n        }\n        localStorage.removeItem(\"success\");\n        postActionDivs.forEach(async (postActionDiv) => {\n            let allLinks = postActionDiv.querySelectorAll('a');\n            var linksWithDataPostId = Array.from(allLinks).filter(function (link) {\n                return link.hasAttribute('data-post-id');\n            });\n\n            if (linksWithDataPostId.length > 0) {\n                var postId = linksWithDataPostId[0].getAttribute('data-post-id');\n                // hide report to moderator in own comment\n                const forumPostUserData = await this.checkForumPostUser(postId);\n                var newLink = document.createElement('a');\n                newLink.href = '#';\n                newLink.classList.add('btn', 'btn-link');\n                newLink.textContent = 'Report to moderator';\n                newLink.setAttribute(\"data-action\", \"forummoderation-reportpost\");\n                newLink.setAttribute('data-post-id', postId);\n                const reported_by = (forumPostUserData.reported_by) ? forumPostUserData.reported_by : 0;\n                newLink.setAttribute(\"data-reported\", reported_by);\n                const useridpost = parseInt(forumPostUserData.useridpost);\n                const userid = parseInt(user);\n\n                if (userid != useridpost) {\n                    postActionDiv.insertBefore(newLink, postActionDiv.firstChild);\n                }\n\n\n\n            }\n        });\n    }\n\n    createAlert(type, title, message) {\n        // Create the alert div element\n        var alertDiv = document.createElement('div');\n        alertDiv.className = 'alert ' + type;\n        alertDiv.setAttribute('role', 'alert');\n\n        // Create the heading element\n        var heading = document.createElement('h4');\n        heading.className = 'alert-heading';\n\n        heading.textContent = title;\n        alertDiv.appendChild(heading);\n\n        // Create the paragraph element for the main content\n        var mainContent = document.createElement('p');\n        mainContent.textContent = message;\n        alertDiv.appendChild(mainContent);\n\n        // Create the horizontal rule element\n        alertDiv.appendChild(document.createElement('hr'));\n\n        // create button okay\n        var button = document.createElement(\"button\");\n        button.setAttribute(\"type\", \"button\");\n        button.classList.add(\"btn\", \"btn-ok-forummoderation\");\n        button.textContent = \"Ok\";\n        button.setAttribute(\"data-action\", \"hide\");\n        alertDiv.appendChild(button);\n        return alertDiv;\n    }\n\n}\nexport default Helpers;"],"names":["Helpers","createSpinner","classname","spinner","document","createElement","className","postId","Promise","resolve","Services","$","ajax","checkForumPostUser","res","JSON","parse","data","strings","GetString","title","get","message","alert","createAlert","titlemodal","ModalFactory","create","body","footer","user","postActionDivs","querySelectorAll","localStorage","getItem","this","modalNotification","show","removeItem","forEach","async","allLinks","postActionDiv","linksWithDataPostId","Array","from","filter","link","hasAttribute","length","getAttribute","forumPostUserData","newLink","href","classList","add","textContent","setAttribute","reported_by","useridpost","parseInt","insertBefore","firstChild","type","alertDiv","heading","appendChild","mainContent","button"],"mappings":";;;;;;;iRA4BMA,QACFC,cAAcC,iBACJC,QAAUC,SAASC,cAAc,cACvCF,QAAQG,UAAYJ,UACbC,iCAGcI,eACd,IAAIC,SAAQC,cACXC,kBAASC,gBAAEC,MAAMC,mBAAmBN,QAAQO,MAC5CL,QAAQM,KAAKC,MAAMF,KAAKG,4CAM1BC,QAAU,IAAIC,iBACdC,YAAcF,QAAQG,IAAI,+BAC1BC,cAAgBJ,QAAQG,IAAI,8BAC5BE,OAAQ,IAAIvB,SAAUwB,YAAY,GAAIJ,MAAOE,SAC7CG,iBAAmBP,QAAQG,IAAI,oCAEjBK,uBAAaC,OAAO,CACpCP,MAAOK,WACPG,KAAML,MACNM,OAAQ,WACT,mBAAE,kDAGuBC,UACxBC,eAAiB3B,SAAS4B,iBAAiB,uBAOP,OAApCC,aAAaC,QAAQ,WAAqB,QACtBC,KAAKC,qBACnBC,OAEVJ,aAAaK,WAAW,WACxBP,eAAeQ,SAAQC,MAAAA,oBACfC,SAAWC,cAAcV,iBAAiB,SAC1CW,oBAAsBC,MAAMC,KAAKJ,UAAUK,QAAO,SAAUC,aACrDA,KAAKC,aAAa,sBAGzBL,oBAAoBM,OAAS,EAAG,KAC5B1C,OAASoC,oBAAoB,GAAGO,aAAa,sBAE3CC,wBAA0BhB,KAAKtB,mBAAmBN,YACpD6C,QAAUhD,SAASC,cAAc,KACrC+C,QAAQC,KAAO,IACfD,QAAQE,UAAUC,IAAI,MAAO,YAC7BH,QAAQI,YAAc,sBACtBJ,QAAQK,aAAa,cAAe,8BACpCL,QAAQK,aAAa,eAAgBlD,cAC/BmD,YAAeP,kBAAkBO,YAAeP,kBAAkBO,YAAc,EACtFN,QAAQK,aAAa,gBAAiBC,mBAChCC,WAAaC,SAAST,kBAAkBQ,YAC/BC,SAAS9B,OAEV6B,YACVjB,cAAcmB,aAAaT,QAASV,cAAcoB,gBASlEtC,YAAYuC,KAAM3C,MAAOE,aAEjB0C,SAAW5D,SAASC,cAAc,OACtC2D,SAAS1D,UAAY,SAAWyD,KAChCC,SAASP,aAAa,OAAQ,aAG1BQ,QAAU7D,SAASC,cAAc,MACrC4D,QAAQ3D,UAAY,gBAEpB2D,QAAQT,YAAcpC,MACtB4C,SAASE,YAAYD,aAGjBE,YAAc/D,SAASC,cAAc,KACzC8D,YAAYX,YAAclC,QAC1B0C,SAASE,YAAYC,aAGrBH,SAASE,YAAY9D,SAASC,cAAc,WAGxC+D,OAAShE,SAASC,cAAc,iBACpC+D,OAAOX,aAAa,OAAQ,UAC5BW,OAAOd,UAAUC,IAAI,MAAO,0BAC5Ba,OAAOZ,YAAc,KACrBY,OAAOX,aAAa,cAAe,QACnCO,SAASE,YAAYE,QACdJ,uBAIAhE"}