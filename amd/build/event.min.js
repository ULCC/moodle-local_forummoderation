define("local_forummoderation/event",["exports","jquery","./selectors","./services","./customformdata","./helpers"],(function(_exports,_jquery,_selectors,_services,_customformdata,_helpers){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * AMD module used when managing enterprise customfields.
   *
   * @module      local_forummoderation
   * @copyright   2024 Yahya (yahya@teruselearning.co.uk)
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   * */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_selectors=_interopRequireDefault(_selectors),_services=_interopRequireDefault(_services),_customformdata=_interopRequireDefault(_customformdata),_helpers=_interopRequireDefault(_helpers);var _default=class{constructor(userid){this.userid=userid,this.reportPostSelector=_selectors.default.actions.reportPost,this.closeModalSelector=_selectors.default.actions.closeModal,this.eventListeners={}}init(){(new _helpers.default).createLinkReportModerator(this.userid)}addEvent(eventType,handler){this.eventListeners[eventType]||(this.eventListeners[eventType]=[],document.addEventListener(eventType,(evt=>{this.eventListeners[eventType].forEach((listener=>{listener.selectors.some((selector=>evt.target.matches(selector)))&&listener.handler.call(this,evt)}))}))),this.eventListeners[eventType].push({selectors:[this.reportPostSelector,this.closeModalSelector],handler:handler})}reportPostForum(evt){if(evt.target.closest(this.reportPostSelector)){evt.preventDefault();const spinner=(new _helpers.default).createSpinner("spinner"),parentElement=evt.target;parentElement.insertAdjacentElement("afterend",spinner),(0,_jquery.default)(evt.target).hide(),(0,_jquery.default)(spinner).show();const postId=parentElement.getAttribute("data-post-id"),message="",formData=this.prepareFormDataReport(postId,message);localStorage.setItem("success",!0),new _services.default(_jquery.default.ajax).reportPost(formData,(res=>{const{success:success}=JSON.parse(res);success&&window.location.reload()}))}}prepareFormDataReport(postId,message){return new _customformdata.default({postId:parseInt(postId),courseId:M.cfg.courseId,contextId:M.cfg.contextid,courseContextId:M.cfg.courseContextId,contextInstanceId:M.cfg.contextInstanceId,action:"report-post",message:message,sesskey:M.cfg.sesskey}).toFormData()}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=event.min.js.map